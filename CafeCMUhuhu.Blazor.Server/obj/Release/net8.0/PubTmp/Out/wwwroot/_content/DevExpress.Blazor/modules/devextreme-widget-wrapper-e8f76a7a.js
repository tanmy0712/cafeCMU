import{g as e,W as t}from"./custom-theme-generator-9dcb87cb.js";import{_ as i}from"./_tslib-6e8ca86b.js";import{S as s}from"./single-slot-element-base-9e7a4622.js";import{C as n}from"./custom-events-helper-e7f279d3.js";import{registerTrialPanelComponents as o}from"./dx-license-dd341102.js";import{n as r}from"./property-4ec0b52d.js";import{d as a}from"./dom-da46d023.js";import{C as d}from"./css-classes-cee8476c.js";import{i as p}from"./dom-utils-c35907a1.js";const c="dxbl-client-component-wrapper";class l extends CustomEvent{constructor(e){super(e,{detail:new m,bubbles:!0,composed:!0,cancelable:!0})}}class h extends CustomEvent{constructor(e){super(h.eventName,{detail:new u(e),bubbles:!0,composed:!0,cancelable:!0})}}h.eventName=`${c}.options-loaded`;class g extends CustomEvent{constructor(e){super(g.eventName,{detail:new C(e),bubbles:!0,composed:!0,cancelable:!0})}}g.eventName=`${c}.loading-panel-visibility-changed`;class m{}class u{constructor(e){this.OptionChunkKeys=e}}class C{constructor(e){this.Visible=e}}n.register(h.eventName,(e=>e.detail)),n.register(g.eventName,(e=>e.detail)),o();const O=e=>e&&"object"==typeof e&&!Array.isArray(e);class b extends s{constructor(){super(...arguments),this.optionChunks="",this._firstLoading=!0,this._loadedChunks=[]}connectedOrContentChanged(){super.connectedOrContentChanged(),this.createComponentIfRequired()}disconnectedCallback(){super.disconnectedCallback(),this.disposeComponent()}firstUpdated(){this._firstLoading=!1}createComponentIfRequired(){if(!this.canCreateComponent())return;const e={};this.deepAssign(e,this.createInitOptions(),this.getServerOptions()),this.createComponent(e)}processSpecialOptions(e){}willUpdate(e){if(!this._firstLoading&&e.has("optionChunks")){const e=this.getServerOptions();e&&this.updateComponent(e)}}parseServerOptions(e){const t=e&&JSON.parse(e);if(!t)return;const i=Object.keys(t).filter((e=>!this._loadedChunks.includes(e))),s=i.map((e=>t[e])),n=this.deepAssign({},...s);return this.processSpecialOptions(n),this.invokeOptionsLoadedEvent(i),this._loadedChunks.push(...i),n}deepAssign(e,...t){if(!t.length)return e;const i=t.shift();if(O(e)&&O(i))for(const[t,s]of Object.entries(i))O(s)?(e[t]||(e[t]={}),this.deepAssign(e[t],s)):e[t]=s;return this.deepAssign(e,...t)}resetEmptyOptions(e,t,i=""){if(!t)return;const s=Object.entries(t).filter((([e])=>!this.getSkippedEmptyOptions().includes(i+e)));for(const[n,o]of s){const s=i+n;Array.isArray(o)?o.forEach(((t,i)=>{O(t)&&this.resetEmptyOptions(e,t,`${s}[${i}].`)})):O(o)&&this.resetEmptyOptions(e,o,`${s}.`),null===o&&(delete t[n],e(s))}}changeLoadingPanelVisibility(e){this.dispatchEvent(new g(e))}invokeOptionsLoadedEvent(e){this.dispatchEvent(new h(e))}getServerOptions(){return this.parseServerOptions(this.optionChunks)}getSkippedEmptyOptions(){return[]}}i([r({attribute:"option-chunks"})],b.prototype,"optionChunks",void 0);const v="dxInstance",f="width",y="height",W="visible",S="locale";class E extends b{constructor(){super(...arguments),this._containerSizeChanged=!1}canCreateComponent(){return!this._widgetPromise&&!!this.getWidgetElement()}createComponent(e){this._widgetPromise=this.initializeWidget(e)}disposeComponent(){var e;null===(e=this._widgetPromise)||void 0===e||e.then((e=>this.disposeWidget(e))).catch((e=>{p(this)||console.error(e)}))}disposeWidget(e){e.dispose()}updateComponent(e){var t;Object.keys(e).length?null===(t=this._widgetPromise)||void 0===t||t.then((t=>this.updateWidgetOptions(t,e))):this._containerSizeChanged&&this.onlyContainerSizeChanged()}createInitOptions(){return{...this.createWidgetDefaultOptions(),...this.createWidgetHandlers()}}createWidgetDefaultOptions(){return{}}createWidgetHandlers(){return{onInitialized:e=>this.onWidgetInitialized(e),onDisposing:e=>this.onWidgetDisposing(e)}}getWidgetCustomTheme(){return e(this.getThemeDependentOptionsDict(),this.getWidgetTypeName(),this)}getThemeDependentOptionsDict(){return{}}async initializeWidget(e){const t=this.getWidgetCustomTheme();t&&(await this.widgetLoader.registerCustomTheme(t),e.theme=t.name),this.processLocalization(e);const i=this.getWidgetElement(),s=this.getWidgetTypeName();return this.widgetLoader.initializeWidget(i,s,e)}get widgetLoader(){var e;return null!==(e=this._loader)&&void 0!==e||(this._loader=t.getInstance()),this._loader}getWidgetElement(){return this.getElementsByClassName(this.getWidgetElementClassName())[0]}getWidgetElementClassName(){return"dxbl-widget-container"}async processLocalization(e){e[S]&&(await this.widgetLoader.setLocalization(e[S]),delete e[S])}updateWidgetOptions(e,t){e.beginUpdate(),this.resetEmptyOptions((t=>{e.resetOption(t)}),t),e.option(t),e.endUpdate()}onWidgetInitialized(e){e.element[v]=e.component}onWidgetDisposing(e){delete e.element[v]}setStyleOptionForElement(e,t){this.getContainerToSetStyle().style.setProperty(e,t)}processSpecialOptions(e){const t=void 0!==e[f],i=void 0!==e[y];this._containerSizeChanged=t||i,t&&(this.setStyleOptionForElement(f,`${e[f]}`),delete e[f]),i&&(this.setStyleOptionForElement(y,`${e[y]}`),delete e[y]),void 0!==e[W]&&a.DomUtils.toggleClassName(this,d.Invisible,!e[W])}getContainerToSetStyle(){return this}onlyContainerSizeChanged(){this.changeLoadingPanelVisibility(!1)}executeClientMethod(e,...t){return this._widgetPromise?this._widgetPromise.then((i=>i[e](...t))):Promise.resolve()}}export{l as C,E as D};
