import{_ as e}from"./_tslib-6e8ca86b.js";import{S as t}from"./single-slot-element-base-9e7a4622.js";import{o as s}from"./constants-86572358.js";import{H as i,V as n,a as o,D as r,b as l}from"./dx-scroll-viewer-d14c6cca.js";import{S as a}from"./scroll-viewer-css-classes-4d6797bc.js";import{L as c,a as d,b as m,c as h,d as u,e as I}from"./dx-list-box-events-62ff2856.js";import{d as p}from"./dom-da46d023.js";import{b}from"./browser-d96520d8.js";import{k as g}from"./key-f9cbed1b.js";import{K as y,F as v}from"./keyboard-navigation-strategy-940ff3b3.js";import{G as S}from"./grid-scroll-utils-85c8cb9d.js";import{D as w}from"./layouthelper-0c7c89da.js";import{addFocusHiddenAttribute as f,removeFocusHiddenAttribute as C}from"./focus-utils-405a64a8.js";import{D as x}from"./dx-html-element-base-fd84f3f8.js";import{a as V}from"./dx-virtual-scroll-viewer-1ee44a82.js";import{e as E}from"./custom-element-267f9a21.js";import"./data-qa-utils-8be7c726.js";import"./const-90026e45.js";import"./dx-ui-element-822e6c84.js";import"./lit-element-base-32a69cc0.js";import"./dx-license-dd341102.js";import"./lit-element-462e7ad3.js";import"./logicaltreehelper-7b19cc30.js";import"./property-4ec0b52d.js";import"./css-classes-cee8476c.js";import"./custom-events-helper-e7f279d3.js";import"./common-f853e871.js";import"./focushelper-cb993bae.js";import"./eventhelper-8570b930.js";import"./constants-791d6f9b.js";import"./dom-utils-c35907a1.js";import"./screenhelper-cc818363.js";import"./point-e4ec110e.js";import"./touch-4bff3f51.js";import"./disposable-d2c2d283.js";import"./dx-html-element-pointer-events-helper-b4d2ae7e.js";import"./devices-afeafb19.js";import"./thumb-c80aa4fc.js";class T extends y{constructor(e,t){super(e.getKeyboardNavigator(),t),this.component=e}getTable(){return this.component.getTable()}getList(){return this.component.getList()}getScrollViewer(){return this.component.getScrollViewer()}getScrollViewerContent(){return this.component.getScrollViewerContent()}getColumnInfoByCell(e){return this.component.getColumnInfoByCell(e)}get isFocusedRowEnabled(){return this.component.enableFocusedRow}get isMultipleSelectionEnabled(){return this.component.enableMultipleSelection}canSwitchToNestedContentMode(){return!0}handleTabKeyDown(e,t=!1){if(!t&&e.altKey)return!1;if(e.shiftKey){if(0===this.selectedItemIndex)return!1;this.moveToPrevItem()}else{if(this.selectedItemIndex===this.itemCount-1)return!1;this.moveToNextItem()}return!0}}class K extends T{constructor(e,t,s){super(t,s),this.lockScroll=0,this.containerStrategy=e}isImmediatelyClickEnabled(){return!1}get preventScrollOnFocus(){return this.lockScroll>0}getVisibleIndex(){return w.getAttributeIntValue(this.targetElement,c.VisibleIndexAttributeName,-1)}leave(){v.removeTabIndex(this.selectedItemElement)}lockScrollOnFocus(){this.lockScroll++}unlockScrollOnFocus(){this.lockScroll--}getShortcutContext(){return{ElementType:this.getElementType(),VisibleIndex:this.getVisibleIndex()}}}class D extends T{constructor(e,t){super(e,t),this.savedVisibleIndex=-1,this.selectedVisibleIndex=-1,this.firstVisibleIndex=-1,this.lastVisibleIndex=-1,this.firstAvailableVisibleIndex=0,this.lastAvailableVisibleIndex=-1,this.requestRestoreSelectedElementIndex=-1,this.boundOnVisibleElementChangedHandler=this.onMakeRowVisible.bind(this),this.addEventSubscriptions()}get enableVirtualRenderMode(){return this.component.enableVirtualRenderMode}get isFirstItemSelected(){return this.selectedVisibleIndex<=this.firstAvailableVisibleIndex}get isLastItemSelected(){return this.selectedVisibleIndex>=this.lastAvailableVisibleIndex}get totalItemCount(){const e=this.component.virtualItemCount;return e>=0?e:this.itemCount}get preventScrollOnFocus(){return this.enableVirtualRenderMode}updateSelectedItemByChildElement(e,t=null){if(this.enableVirtualRenderMode){const s=t instanceof MouseEvent,i=this.findItemElementIndexByChild(e);return s?this.selectedVisibleIndex=d.getElementVisibleIndex(this.items[i]):i!==this.selectedItemIndex&&this.isElementInsideViewport(this.selectedVisibleIndex)&&(this.requestRestoreSelectedElementIndex=this.selectedVisibleIndex),void this.updateSelectedItemByIndex(i)}super.updateSelectedItemByChildElement(e,t)}initialize(){super.initialize(),this.resetState(),this.updateBoundaries(),this.updateViewportBoundaries()}activate(){if(this.enableVirtualRenderMode)if(this.requestRestoreSelectedElementIndex>-1)this.notifyMakeElementVisible(this.requestRestoreSelectedElementIndex,null),this.requestRestoreSelectedElementIndex=-1;else if(this.selectedVisibleIndex>-1)if(this.isElementInsideViewport(this.selectedVisibleIndex)){const e=d.findItemIndex(this.selectedVisibleIndex,this.items);e>-1&&this.selectViewportItem(e)}else f(this.targetElement);else this.selectViewportItem(this.selectedItemIndex);else super.activate()}onDispose(){this.resetState(),this.removeEventSubscriptions(),super.onDispose()}getSelectedItemStrategy(){return super.getSelectedItemStrategy()}selectItem(e){const t=this.getSelectedItemStrategy(),s=this.getStrategy(e),i=s.getVisibleIndex();this.selectedVisibleIndex=i,this.savedVisibleIndex=i,C(this.targetElement),super.selectItem(e),t&&t!==s&&t.leave()}handleKeyDown(e){switch(g.KeyUtils.getEventKeyCode(e)){case g.KeyCode.Up:return this.handleArrowUpKeyDown();case g.KeyCode.Down:return this.handleArrowDownKeyDown();case g.KeyCode.PageDown:return this.handlePageDown();case g.KeyCode.PageUp:return this.handlePageUp();case g.KeyCode.Home:return this.handleHomeKeyDown(e)||this.performShortcutEvent(e),!0;case g.KeyCode.End:return this.handleEndKeyDown(e)||this.performShortcutEvent(e),!0;case g.KeyCode.Space:return this.performShortcutEvent(e),!0}return!1}handleKeyUp(e){switch(g.KeyUtils.getEventKeyCode(e)){case g.KeyCode.Down:case g.KeyCode.Up:case g.KeyCode.PageUp:case g.KeyCode.PageDown:case g.KeyCode.Home:case g.KeyCode.End:this.notifyFocusedRowChanged()}return!1}moveToPrevItem(){super.moveToPrevItem(),this.scrollToElement(null,i.None)}moveToNextItem(){super.moveToNextItem(),this.scrollToElement(null,i.None)}selectViewportItem(e){const t=this.getStrategy(e);t.lockScrollOnFocus(),this.selectItem(e),t.unlockScrollOnFocus()}moveToPrevVirtualItem(){const e=this.selectedVisibleIndex-1;this.isElementInsideViewport(e)&&this.selectedItemIndex>0?(this.selectViewportItem(this.selectedItemIndex-1),this.scrollToElement(null,i.None)):this.notifyMakeElementVisible(e,n.Top)}moveToNextVirtualItem(){const e=this.selectedVisibleIndex+1;this.isElementInsideViewport(e)&&this.selectedItemIndex<this.totalItemCount-1?(this.selectViewportItem(this.selectedItemIndex+1),this.scrollToElement(null,i.None)):this.notifyMakeElementVisible(e,n.Bottom)}handleArrowUpKeyDown(){return!this.isFirstItemSelected&&(this.enableVirtualRenderMode?this.moveToPrevVirtualItem():this.moveToPrevItem(),!0)}handleArrowDownKeyDown(){return!this.isLastItemSelected&&(this.enableVirtualRenderMode?this.moveToNextVirtualItem():this.moveToNextItem(),!0)}handleHomeKeyDown(e){return this.savedVisibleIndex=-1,!this.isFirstItemSelected&&(this.enableVirtualRenderMode?this.moveToFirstVirtualItem():this.moveToFirstItem(),!(e.ctrlKey&&e.shiftKey))}moveToFirstItem(){this.getScrollViewer()&&(this.selectItem(0),this.scrollToElement(n.Top,i.None))}moveToFirstVirtualItem(){this.isElementInsideViewport(0)&&this.selectedItemIndex>0?(this.selectViewportItem(0),this.scrollToElement(n.Top,i.None)):this.notifyMakeElementVisible(0,n.Top)}handleEndKeyDown(e){return this.savedVisibleIndex=-1,!this.isLastItemSelected&&(this.enableVirtualRenderMode?this.moveToLastVirtualItem():this.moveToLastItem(),!(e.ctrlKey&&e.shiftKey))}moveToLastItem(){this.component.getScrollViewer()&&(this.selectItem(this.itemCount-1),this.scrollToElement(n.Bottom,i.None))}moveToLastVirtualItem(){const e=this.totalItemCount-1;this.isElementInsideViewport(e)&&this.selectedItemIndex<this.itemCount-1?(this.selectViewportItem(this.itemCount-1),this.scrollToElement(n.Bottom,i.None)):this.notifyMakeElementVisible(e,n.Bottom)}handlePageUp(){return this.savedVisibleIndex=-1,!this.isFirstItemSelected&&(this.enableVirtualRenderMode?this.moveToPrevVirtualPageItem():this.moveToPrevPageItem(),!0)}moveToPrevPageItem(){const e=this.component.getScrollViewer();if(e){const t=S.calculateBoundaryItemIndex(this,e,!1);this.selectItem(t<0?0:t),this.scrollToElement(n.Top,i.None)}}moveToPrevVirtualPageItem(){const e=this.component.getScrollViewer();if(e){const t=S.calculateBoundaryItemIndex(this,e,!1),s=this.selectedVisibleIndex+(t-this.selectedItemIndex);this.isElementInsideViewport(s)?(this.selectViewportItem(t),this.scrollToElement(n.Top,i.None)):this.notifyMakeElementVisible(s,n.Top)}}handlePageDown(){return this.savedVisibleIndex=-1,!this.isLastItemSelected&&(this.enableVirtualRenderMode?this.moveToNextVirtualPageItem():this.moveToNextPageItem(),!0)}moveToNextPageItem(){const e=this.itemCount-1,t=this.component.getScrollViewer();if(t){const s=S.calculateBoundaryItemIndex(this,t,!0);this.selectItem(s>e?e:s),this.scrollToElement(n.Bottom,i.None)}}moveToNextVirtualPageItem(){const e=this.component.getScrollViewer();if(e){const t=S.calculateBoundaryItemIndex(this,e,!0),s=this.selectedVisibleIndex+(t-this.selectedItemIndex);this.isElementInsideViewport(s)?(this.selectViewportItem(t),this.scrollToElement(n.Bottom,i.None)):this.notifyMakeElementVisible(s,n.Bottom)}}onMakeRowVisible(e){if(e.detail.isFocusRequired){const t=this.items.indexOf(e.detail.element);this.selectItem(t)}}addEventSubscriptions(){const e=this.getScrollViewer();e&&e.addEventListener(o.eventName,this.boundOnVisibleElementChangedHandler)}removeEventSubscriptions(){const e=this.getScrollViewer();e&&e.removeEventListener(o.eventName,this.boundOnVisibleElementChangedHandler)}getStrategy(e){return this.getItemStrategy(e)}notifyFocusedRowChanged(){this.isFocusedRowEnabled&&this.savedVisibleIndex>-1&&(this.component.notifyFocusedRowChanged(this.savedVisibleIndex),this.savedVisibleIndex=-1)}scrollToElement(e,t){const s=this.getScrollViewer();s&&r.scrollToElementRelyOnStickyDescendants(this.selectedItemElement,e,t,s)}notifyMakeElementVisible(e,t=null){e<0||this.component.notifyMakeElementVisible(e,d.getVerticalEdge(t))}updateBoundaries(){this.firstAvailableVisibleIndex=0,this.lastAvailableVisibleIndex=this.totalItemCount-1}updateViewportBoundaries(){if(0===this.itemCount)return;const e=this.items[0];this.firstVisibleIndex=e?d.getElementVisibleIndex(e):-1;const t=this.items[this.itemCount-1];this.lastVisibleIndex=t?d.getElementVisibleIndex(t):-1}isElementInsideViewport(e){return e>=this.firstVisibleIndex&&e<=this.lastVisibleIndex}resetState(){this.firstAvailableVisibleIndex=-1,this.lastAvailableVisibleIndex=-1,this.firstVisibleIndex=-1,this.lastVisibleIndex=-1}}var N,R;!function(e){e[e.Undefined=0]="Undefined",e[e.HeaderRow=1]="HeaderRow",e[e.DataRow=2]="DataRow",e[e.ListItem=3]="ListItem",e[e.EmptyData=4]="EmptyData"}(N||(N={})),function(e){e[e.None=0]="None",e[e.Table=1]="Table",e[e.List=2]="List"}(R||(R={}));class k{static getElementType(e){return e.matches(m.HeaderRowSelector)?N.HeaderRow:e.matches(m.TableRowSelector)?N.DataRow:e.matches(m.ListItemSelector)?N.ListItem:N.Undefined}static getNavigationAreaType(e){return e.matches(m.TableSelector)?R.Table:e.matches(m.ListSelector)?R.List:R.None}static isSelectionCell(e){var t;return null!==(t=null==e?void 0:e.matches(`.${h.TableSelectionCellClassName}`))&&void 0!==t&&t}static isItemDisplayTemplateContainer(e){var t;return null!==(t=null==e?void 0:e.matches(`.${h.ItemDisplayTemplateContainer}`))&&void 0!==t&&t}}class M extends T{constructor(e,t){super(e,t),this.savedSelectedColumnUid=null}saveSelectedColumn(e){this.savedSelectedColumnUid=e.getSelectedColumnUid()}syncSelectedColumn(e){e.syncSelectedColumn(this.savedSelectedColumnUid)}queryItems(){return this.queryItemsBySelector(m.TablePartsSelector)}createItemStrategy(e){return e.matches("thead")?new j(this,this.component,e):e.matches("tbody")?new U(this,this.component,e):null}selectItem(e){const t=this.getStrategy(e),s=this.getSelectedItemStrategy();s&&s!==t&&s.leaveTablePart(),t.activate()}handleKeyDown(e){switch(g.KeyUtils.getEventKeyCode(e)){case g.KeyCode.PageUp:case g.KeyCode.PageDown:case g.KeyCode.Home:case g.KeyCode.End:return this.handleBodyShortcut(e)}return!1}handleBodyShortcut(e){const t=this.items.findIndex((e=>e.matches("tbody"))),s=this.getStrategy(t);return!!(t>=0&&s&&s!==this.getSelectedItemStrategy())&&s.handleKeyDown(e)}getStrategy(e){return this.getItemStrategy(e)}syncSelectedColumns(e){const t=this.getSelectedItemStrategy();if(t){const s=t.getSelectedItemStrategy(),i=e.getSelectedItemStrategy();s&&i&&e.syncSelectedColumns(s,i)}}}class P extends D{constructor(e,t,s){super(t,s),this.parentTableStrategy=e}leaveTablePart(){}syncSelectedColumns(e,t){return!(!e||e===t||(this.isColumnSyncRequired(e.getElementType())&&this.parentTableStrategy.saveSelectedColumn(e),!this.isColumnSyncRequired(t.getElementType())))&&(this.parentTableStrategy.syncSelectedColumn(t),!0)}queryItems(){return this.queryItemsBySelector(m.RowSelector)}isColumnSyncRequired(e){switch(e){case N.HeaderRow:case N.DataRow:return!0}return!1}getShortcutContext(){return{AreaType:R.Table}}getStrategy(e){return this.getItemStrategy(e)}getSelectedItemStrategy(){return super.getSelectedItemStrategy()}}class j extends P{constructor(e,t,s){super(e,t,s)}createItemStrategy(e){if(k.getElementType(e)===N.HeaderRow)return new L(this,this.component,e);throw new Error("Not implemented")}}class U extends P{constructor(e,t,s){super(e,t,s)}createItemStrategy(e){return e.matches(m.TableRowSelector)?new F(this,this.component,e):e.matches(m.EmptyDataItemSelector)?new H(this,this.component,e):null}leaveTablePart(){super.leaveTablePart(),this.notifyFocusedRowChanged()}}class B extends K{constructor(e,t,s){super(e,t,s)}getSelectedColumnUid(){var e;return null!==(e=this.getColumnUidByCell(this.selectedItemElement))&&void 0!==e?e:null}syncSelectedColumn(e){const t=null!==e?this.items.findIndex((t=>this.getColumnUidByCell(t)===e)):-1;this.selectedItemIndex=Math.max(t,0)}getColumnUidByCell(e){var t;return null===(t=this.getColumnInfoByCell(e))||void 0===t?void 0:t.uID}}class L extends B{constructor(e,t,s){super(e,t,s)}getElementType(){return N.HeaderRow}isImmediatelyClickEnabled(){return!0}}class F extends B{constructor(e,t,s){super(e,t,s)}getElementType(){return N.DataRow}handleKeyDown(e){return this.nestedContentSelected||g.KeyUtils.getEventKeyCode(e)!==g.KeyCode.Space?super.handleKeyDown(e):(this.performShortcutEvent(e),!0)}}class H extends B{constructor(e,t,s){super(e,t,s)}getElementType(){return N.EmptyData}}class O extends D{constructor(e,t){super(e,t)}getShortcutContext(){return{AreaType:R.List}}queryItems(){return this.queryItemsBySelector(m.ItemSelector)}createItemStrategy(e){return e.matches(m.ListItemSelector)?new q(this,this.component,e):e.matches(m.EmptyDataItemSelector)?new A(this,this.component,e):null}}class q extends K{constructor(e,t,s){super(e,t,s)}getElementType(){return N.ListItem}handleKeyDown(e){return this.nestedContentSelected||g.KeyUtils.getEventKeyCode(e)!==g.KeyCode.Space?super.handleKeyDown(e):(this.performShortcutEvent(e),!0)}}class A extends K{constructor(e,t,s){super(e,t,s)}getElementType(){return N.EmptyData}}class z extends T{constructor(e){super(e,e)}getShortcutContext(){return{IsMacOSPlatform:b.Browser.MacOSPlatform}}queryItems(){return new Array(this.getList(),this.getTable())}createItemStrategy(e){switch(k.getNavigationAreaType(e)){case R.Table:return new M(this.component,e);case R.List:return new O(this.component,e)}return null}moveToPrevItem(){this.selectedItemIndex>0?super.moveToPrevItem():this.leaveBackward()}moveToNextItem(){this.selectedItemIndex<this.itemCount-1?super.moveToNextItem():this.leaveForward()}handleKeyDown(e){const t=g.KeyUtils.getEventKeyCode(e);return t===g.KeyCode.Tab?this.handleTabKeyDown(e):t===g.KeyCode.Up&&e.ctrlKey?(this.moveToPrevItem(),!0):!(t!==g.KeyCode.Down||!e.ctrlKey)&&(this.moveToNextItem(),!0)}handleTabKeyDown(e){return super.handleTabKeyDown(e,e.altKey)||(e.shiftKey?this.leaveBackward():this.leaveForward()),!0}}class _{constructor(e){this._uID=e}get uID(){return this._uID}}let $=class extends t{constructor(){super(),this._focusedRowIndex=-1,this._columnsInfo=[],this.boundOnScrollViewerUpdateHandler=this.onScrollViewerUpdate.bind(this),this.boundOnMouseDownHandler=this.onMouseDown.bind(this),this.resizeObserver=new ResizeObserver(this.onSizeChanged.bind(this))}connectedCallback(){super.connectedCallback(),this.addEventSubscriptions(),this.resizeObserver.observe(this)}disconnectedCallback(){delete this.keyboardNavigator,this.removeEventSubscriptions(),this.resizeObserver.disconnect(),super.disconnectedCallback()}contentChanged(){super.contentChanged(),this.initializeKeyboardNavigator()}getScrollViewer(){return this.querySelector(`.${a.ClassName}`)}getScrollViewerContent(){return this.querySelector(`.${a.ContentContainerClassName}`)}getTable(){return this.querySelector(m.TableSelector)}getList(){return this.querySelector(m.ListSelector)}getKeyboardNavigator(){return this.keyboardNavigator}notifyFocusedRowChanged(e){e!==this.focusedRowIndex&&this.enableFocusedRow&&(this.focusedRowIndex=e,this.dispatchEvent(new u(e)))}notifyMakeElementVisible(e,t){e<0||this.dispatchEvent(new I(e,t))}notifyColumnsChanged(e){this._columnsInfo=e}getColumnInfoByCell(e){if(e instanceof HTMLElement){const t=this.getElementIndex(e);if(t>=0&&t<this._columnsInfo.length)return this._columnsInfo[t]}return null}get isTableRender(){return!!this.getTable()}get focusedRowIndex(){return this._focusedRowIndex}set focusedRowIndex(e){this._focusedRowIndex=e}get enableFocusedRow(){return!1}get enableMultipleSelection(){return this.classList.contains(h.MultiSelectClassName)}get enableVirtualRenderMode(){const e=this.getScrollViewer();return null!==e&&e instanceof V}get virtualItemCount(){const e=this.getScrollViewer();return e&&e instanceof V?e.totalItemCount:-1}initializeKeyboardNavigator(){this.keyboardNavigator=this.querySelector(m.KeyboardNavigatorSelector),this.keyboardNavigator&&!this.keyboardNavigator.initialized&&this.keyboardNavigator.initialize(this,new z(this))}addEventSubscriptions(){this.addEventListener(l.eventName,this.boundOnScrollViewerUpdateHandler),b.Browser.Firefox&&this.isTableRender&&this.addEventListener("mousedown",this.boundOnMouseDownHandler)}removeEventSubscriptions(){this.removeEventListener(l.eventName,this.boundOnScrollViewerUpdateHandler),b.Browser.Firefox&&this.isTableRender&&this.removeEventListener("mousedown",this.boundOnMouseDownHandler)}onScrollViewerUpdate(e){const t=this.getScrollViewerContent(),s=this.getTable();t&&s&&(s.offsetHeight<t.clientHeight?p.DomUtils.addClassName(s,h.TableNoScrollClassName):p.DomUtils.removeClassName(s,h.TableNoScrollClassName)),e.stopPropagation()}onSizeChanged(e){const t=this.getScrollViewer();t&&t.refreshUI&&t.refreshUI()}onMouseDown(e){e.ctrlKey&&e.preventDefault()}getElementIndex(e){if(!e)return-1;if(e instanceof HTMLTableCellElement)return e.cellIndex;if(e&&e.parentElement)for(let t=0;t<e.parentElement.children.length;t++)if(e.parentElement.children[t]===e)return t;return-1}};$=e([E(s)],$),customElements.define("dxbl-list-box-columns-info",class extends x{get data(){return this.getAttribute("data")}get componentClassName(){return this.getAttribute("component-class-name")}get columns(){return null!==this.data?this.parseColumns(this.data):[]}constructor(){super()}connectedCallback(){var e;super.connectedCallback(),this.component=this.closest(`.${this.componentClassName}`),null===(e=this.component)||void 0===e||e.notifyColumnsChanged(this.columns)}parseColumns(e){const t=JSON.parse(e),s=[];for(let e=0;e<t.length;e++){const i=new _(t[e].UID);s.push(i)}return s}static get observedAttributes(){return["data"]}attributeChangedCallback(e,t,s){var i;if("data"===e)null===(i=this.component)||void 0===i||i.notifyColumnsChanged(this.parseColumns(s))}});const G={loadModule:function(){}};export{$ as DxListBox,G as default};
